{% extends 'base.html' %}
{% block content %}
  {% include "_partials/manager_header.html" with context %}
  <div class="section">
    <div class="wrap"> 
      <table class="manager-dashboard">
        <thead>
          <th>Agent</th>
          <th>Primary Network</th>
          <th>Extended Network</th>
          <th>Total Network</th>
          <th>Avg Income Score</th>
          <th>Avg Age</th>
          <th class="completed">Completed</th>
        </thead>
        <tbody>
        <tr>
        </tr>
        {% if agent_count < 1 %}
        <tr>
          <td colspan='7'><h4>Add some agents to get started!</h4></td>
        </tr>
        {% else %}
        {% for agent in agents %}
        <tr>
          <td class="agent"><span style="background-image:url({{ agent.image_url }})" class="face"></span><span>{{ agent.name }}<span class='email'>{{ agent.email }}</span></span></td>
          <td>{% if agent.has_prospects %}{{ agent.primary_network_size }}{% else %}N/A{% endif %}</td>
          <td>{% if agent.has_prospects %}{{ agent.extended_network_size }}{% else %}N/A{% endif %}</td>
          <td>{% if agent.has_prospects %}{{ agent.total_network_size }}{% else %}N/A{% endif %}</td>
          <td>{% if agent.has_prospects %}{{ agent.average_income_score }}{% else %}N/A{% endif %}</td>
          <td>{% if agent.has_prospects %}{{ agent.average_age }}{% else %}N/A{% endif %}</td>
          <td class="completed {% if agent.p200_completed %}yes{% else %}{% endif %}">{% if not agent.p200_completed and agent.hiring_screen_completed %}<button>Request P200</button>{% else %}{% if not agent.p200_completed %}<span class='pending'>Pending</span>{% endif %}{% endif %}</td>
        </tr>
        {% endfor %}
        {% endif %}
        </tbody>
      </table>
  </div>
</div>
<script type='text/javascript'>
var csrftoken = "{{ csrf_token() }}"
$(function() {
    $("#send").click(function() {
        var email = $("[name='email']").val();
        var first_name = $("[name='first_name']").val();
        var last_name = $("[name='last_name']").val();
        if (email == '' || first_name == '' || last_name == '') {
          alert("You must fill out all fields");
          return false;
        }
        var data = {csrf_token:csrftoken, 
                  first_name:first_name,
                  last_name:last_name, 
                  email:email}
        $.post("/managers/invite", data, function(data) {
          if (data.error) {
            alert(data.error)
          }
          $(".invite-box").slideUp();
          $(".invite-agent").fadeOut();
      });
    });

    $("#close").click(function() {
        $(".invite-box").slideUp();
        $(".invite-agent").fadeOut();
    });

    $("#invite").click(function() {
          $(".invite-agent").fadeIn();
          $(".invite-box").slideDown();
    });
});
</script>
{% endblock %}
