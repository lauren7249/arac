{% extends 'base.html' %}
{% block content %}
  {% include "_partials/manager_header.html" with context %}
  <div class="section">
    <div class="wrap"> 
      <table class="manager-dashboard">
        <thead>
          <th>Agent</th>
          <th>Primary Network</th>
          <th>Extended Network</th>
          <th>Total Network</th>
          <th>Avg Income Score</th>
          <th>Avg Age</th>
          <th class="completed">Completed</th>
        </thead>
        <tbody>
        <tr>
        </tr>
        {% if agent_count < 1 %}
        <tr>
          <td colspan='7'><h4>Add some agents to get started!</h4></td>
        </tr>
        {% else %}
        {% for agent in agents %}
        <tr>
          <td class="agent"><span style="background-image:url({{ agent.image_url }})" class="face"></span><span>{{ agent.name }}<span class='email'>{{ agent.email }}</span></span></td>
          <td>{% if agent.has_prospects %}{{ agent.primary_network_size }}{% else %}N/A{% endif %}</td>
          <td>{% if agent.has_prospects %}{{ agent.extended_network_size }}{% else %}N/A{% endif %}</td>
          <td>{% if agent.has_prospects %}{{ agent.total_network_size }}{% else %}N/A{% endif %}</td>
          <td>{% if agent.has_prospects %}{{ agent.average_income_score }}{% else %}N/A{% endif %}</td>
          <td>{% if agent.has_prospects %}{{ agent.average_age }}{% else %}N/A{% endif %}</td>
          <td data-td='{{ agent.user_id }}' class="completed {% if agent.p200_completed %}yes{% else %}{% endif %}">
            {% if agent.status == 'p200_completed' %}
            {% elif agent.status == 'p200_started' %}
            <span class='pending'>P200 Pending</span>
            {% elif agent.status == 'hiring_screen_completed' %}
            <button data-p200-id='{{ agent.user_id }}' class='button teal small'>Request P200</button>
            <a target='_blank' href='/managers/agent/{{ agent.user_id }}'><button class='button dark-blue small'>View Hiring Screen</button></a>
            {% else %}
            <span class='pending'>Pending</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
        {% endif %}
        </tbody>
      </table>
  </div>
</div>
<script type='text/javascript'>
var csrftoken = "{{ csrf_token() }}"
$(function() {

    $("[data-p200-id]").click(function() {
        var user_id = $(this).data("p200-id")
        $.post("/managers/request_p200", {user_id:user_id}, function(data){
            $('["data-td="' + user_id + '"]').html("<span class='pending'>P200 Pending</span>")
            alert("P200 Started");
          });
      });


});
</script>
{% endblock %}
