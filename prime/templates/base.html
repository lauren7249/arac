<!doctype html>
<html>
<script type="text/javascript">
  var ua = navigator.userAgent.toLowerCase();
  
  if (!/msie 10/.test(ua) && //IE 10
      ua != 'Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko'.toLowerCase() && //IE 11
      !/chrome/.test(ua) 
      //TODO: add safari mozilla/5.0 (macintosh; intel mac os x 10_10_5) applewebkit/601.5.17 (khtml, like gecko) version/9.1 safari/601.5.17
      //TODO: add ipad
      //TODO: add firefox
      ) {
    alert("This browser is not supported by this application. Please use Chrome or Internet Explorer 10 or 11.");
    alert(ua);
    window.location = "about:blank";
  } 

</script>
  <head>
    <title>AdvisorConnect</title>
    <link rel="shortcut icon" type="image/x-icon" href="/static/img/favicon.ico">
    <link rel="stylesheet" href="/static/css/jquery-ui.css">
    {% assets "css_all" %}
      <link rel='stylesheet' href="{{ ASSET_URL }}">
    {% endassets %}

    <meta name='title' content='' />
    <meta name='description' content='' />
    <meta name='keywords' content='' />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Google Site Verification -->
    <meta name='google-site-verification' content="" />

    <!-- Facebook Open Graph -->
    <meta property="fb:admins" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:title" content="" />
    <meta property="og:url" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="" />
    <meta property="og:image" content="" />
    <meta property="fb:page_id" content="" />

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/react-with-addons-0.12.2.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery-ui.js"></script>
    <script src="/static/js/dropzone.js"></script>

  </head>
  <body>        

    {% block modal %}
       <div id="dropzoneModal" class="dropzone_upload">
        <div class="dialog">
          <div class="toast-close">
            <button type="button" onclick='$("#dropzoneModal").fadeOut();'>&times;</button>  
          </div>  
          <form action="/upload_dropzone" method="post" class="dropzone" id="my-awesome-dropzone"></form>
        </div>
        <script type="text/javascript">
          Dropzone.options.myAwesomeDropzone = { 
            acceptedFiles: ".csv",
            init: function() {
              var myDropzone = this;
              myDropzone.on("complete", function (file) {
                if (myDropzone.getUploadingFiles().length === 0 && myDropzone.getQueuedFiles().length === 0) {
                  $("#dropzoneModal").fadeOut();
                  window.location.reload();
                }
              });
            }
           }
         </script>
      </div>
    {% endblock %}

    {% block spinner %}
      <div id="spinner" class="overlay">    
        <div class="dialog">
          <img src='/static/img/loading.gif'/>
        </div>
      </div>
    {% endblock %}


    {% block progress %}
      <div id="progress" class="overlay">
        <div class="dialog">
          <div class="progress-bar" value="" max="100" id="progress-bar"></div>
          <small>Loading...</small>
        </div>
      </div>
    {% endblock %}
    

    {% block header %}
      <header style="position:fixed; z-index:9; width:100%;">
        <div class="wrap">
          <div class="col-6">
            <div id="header_logo"></div>
          </div>
          <div class="col-6">
            {% if current_user.is_authenticated() %}
            <div data-user-id='{{ current_user.user_id }}' class="nav-right text-right" data-step="4" data-intro="You can add up to 200 of your best contacts but remember you need at least 50 to complete your Project 200.">
                {% if not current_user.is_manager and current_user.p200_completed %}
                  <span><div class="contacts-left" id="contacts-left">{{ current_user.p200_count }} Contacts</div></span>
                {% endif %}
                <span id="settings">                  
                  <a class="user" id="current_user_name">{{ current_user.name }}</a>
                  <!-- <span style="background-image:url({{ current_user.image }})" class="face" id="current_user_image"></span> -->
                  <div class='autocomplete'>
                    <ul>
                      <li><small>{{ current_user.email }}</small></li>
                      <li><a href='/auth/logout'>Logout</a></li>
                    </ul>
                  </div>
                </span>
            {% endif %}
          </div>
        </div>
      </header>
      <header>
        <div class="wrap">
          <div class="col-6">
          </div>
          <div class="col-6">
          </div>   
        </div>   
      </header>
    {% endblock %}

    {% block toasts %}
    <div id='success' class="toast--success" style="display:none;">
      <div class='wrap'>        
        <div class="toast-message" id="p200_success_message" >
          <b>Success!</b>
        </div>
        <div class="toast-close">
          &times;
        </div>
      </div>
    </div>
    
    <div id='error' class="toast--error" style="display:none;">
      <div class='wrap'>
        <div class="toast-message" id="p200_error_message" >
          <b>Error!</b>
        </div>
        <div class="toast-close">
          &times;
        </div>
      </div>
    </div>
    {% endblock %}

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="wrap flashed-messages">
          {% for message in messages %}
            <div class='success'>
              <span>{{ message }}</span>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <script type='text/javascript'>
      $( document ).ready(function() {
        var local = document.location.href.split("/").slice(2,3).join("/").trim().toLowerCase();
        if (local == 'demo.advisorconnect.co') {
          $("#header_logo").attr('class', 'generic-logo');
          $("#faq").css("display","none");  
        } else {
          $("#header_logo").attr('class', 'header-logo');
          $("#faq").css("display","inline");  
        }
          
      });    

      $("#success").click(function(){
        $("#success").css("display","none");  
        document.getElementById("success").close();    
      });
      $("#error").click(function(){
        $("#error").css("display","none");  
        document.getElementById("error").close();    
      });

      function showSuccess(message) {
        $("#p200_success_message").text(message);
        $("#spinner").css("display","none");          
        $("#success").css("display","block");      
      }

      function showError(message) {
        $("#p200_error_message").text(message);
        $("#spinner").css("display","none");          
        $("#error").css("display","block");      
      }   

      var csrftoken = "{{ csrf_token() }}"
      $(function() {

        $("[id$=_p200_button]").click(function() {
          var user_id = $(this).data("p200-id");
          var name = $(this).name;
          if (user_id != undefined && user_id != null && user_id != '') {
            document.getElementById("spinner").style.display = "block";                 
            document.getElementById("success").style.display = "block";   
            $.post("/managers/request_p200", {user_id:user_id}, function(data){
              if (data.name != undefined && data.name !=null && data.name != '') {
                showSuccess(data.name + "'s P200 has been requested and should be available within 24 hours.");
                document.getElementById(user_id + "_p200_button").style.display = "none";     
                document.getElementById(user_id + "_p200_pending").style.display = "block";   
              }

            });          
          }

        });
      });

      $(function() {
        var $page = 1;
        var isSearching = false;

        function bindPagination() {
         $("[data-page]").click(function() {
           showLoader()
           $page = $(this).data('page');
           search()
           hideLoader()
         });
        }

        function hideLoader() {
          $(".loading").fadeOut();
        }

        function showLoader() {
          $(".loading").show();
        }

        function search() {
           if (isSearching) {
             return false;
           }
           isSearching = true;
           $('html, body').animate({scrollTop: "221px"});
           $("#connections-section").load(window.location.pathname + "?p=" + $page + " #connections", function() {
               isSearching = false;
               bindPagination();
               hideLoader();
               $("[data-page]").removeClass("active")
               $("[data-page='" + $page + "']").addClass("active")
           });
        }
        bindPagination();
        hideLoader();
      });

    </script>   
    {% block content %}{% endblock %}
    
    {% block footer %}    
      <footer>
        <div class="wrap">        
          <div class="copyright">&copy; 2016 AdvisorConnect</div>
          <div class="footer-links">
            <span id="faq"><a href="/faq">FAQs</a></span>
            <span><a href="/terms">Terms</a></span>
            <span><a href="mailto:support@advisorconnect.co" target="_blank">Contact</a></span>
          </div>        
        </div>
      </footer>
    {% endblock %}
  </body>

</html>

