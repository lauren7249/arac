{% extends 'base.html' %}
{% block header %}{% endblock %}

{% block content %}

<div id="linkedin_password_form">
  <form class="card" id='linkedin-login-form' method='POST' autocomplete="false">
    <header>
      <div class="header-logo"></div>
    </header>
    <h3>Please enter your Linkedin username (email) and password so we can securely connect your contacts.</h3>
    <hr>

    {{ form.csrf_token }}

    <div class="col-8">
      <input type="email" name='email' class="form-control" id="inputEmail" placeholder="Enter Your LinkedIn Email Address" autocomplete="new-email">
    </div>
    <div class="col-8">
      <input type="password" name='password' class="form-control" id="inputPassword" placeholder="Enter Your LinkedIn Password" autocomplete="new-password">
    </div>
    <div class="col-4">
      <button id="check_linkedin_button" type="submit" class="button fluid linkedin">Connect Linkedin Contacts</button>
    </div>
    <div>
      <small>
        <a href='https://www.linkedin.com/uas/request-password-reset?trk=uno-reg-guest-home-forgot-password' target="_blank">Forgot Your Linkedin Password?</a>
      </small>
    </div>
  </form>
</div>
<script type="text/javascript">
  $(function(){
    var listening;

    function didLinkedinLoginWork() {
      $.get("/linkedin_login_status", function(data){
        if (data.finished) {
          if (data.success) {
            window.close()
          } else if (data.pin) {
            window.location.href = '/linkedin_pin'
          } else {
            clearInterval(listening)
            $(".overlay").fadeOut();
            $(".waiting").hide();
            alert("There was an error with your email and password. Please try again.")
          }
        } else {
          console.log("Not Finished")
        }
      })
    }

    function listenForSuccess() {
      listening = setInterval(function() {
        didLinkedinLoginWork()
      }, 5000);
    }

    $("#linkedin-login-form").submit(function(e){
      e.preventDefault();
      $(".overlay").fadeIn();
      $(".waiting").show();
      var data = {email:$("#inputEmail").val(),password:$("#inputPassword").val()}
      $.post("/linkedin_login", data, function(data){
        if (data.success) {
          listenForSuccess()
        } else {
          alert("Email and Password required!")
        }
      });
    });

    if ("{{ valid }}" == "True" || "{{ contact_count }}" ==-1) {
      $('#overlay', window.parent.document).hide();
      window.close();
    }
      
  });
</script>
{% endblock %}





{% block footer %}{% endblock %}
